<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> sqlite3在Android上的简单应用 · Hyyy的技术博客</title><meta name="description" content="sqlite3在Android上的简单应用 - Hyyy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hyyy的技术博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="http://www.jianshu.com/u/eee3fae14bec" target="_blank" class="nav-list-link">简书</a></li><li class="nav-list-item"><a href="https://github.com/castial" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">sqlite3在Android上的简单应用</h1><div class="post-info">Jul 2, 2014</div><div class="post-content"><blockquote>
<p>sqlite数据库是一款轻量级的关系型数据库，它的运算速度快，占用内存小，特别适合移动设备上的使用。本篇文章是sqlite在android设备上的简单使用。  </p>
</blockquote>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>sqlite创建数据库和mysql差别不大，如果您会用mysql的话，那么sqlite上手是比较容易的。新建一个MyDatabaseHelper类，具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">package com.example.databasetest;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line">import android.database.sqlite.SQLiteDatabase;</div><div class="line">import android.database.sqlite.SQLiteDatabase.CursorFactory;</div><div class="line">import android.database.sqlite.SQLiteOpenHelper;</div><div class="line">import android.widget.Toast;</div><div class="line"></div><div class="line">public class MyDatabaseHelper extends SQLiteOpenHelper &#123;</div><div class="line"></div><div class="line">	public static final String CREATE_BOOK = &quot;create table Book(&quot; +</div><div class="line">			&quot;id integer primary key autoincrement,&quot; +</div><div class="line">			&quot;author text,&quot; +</div><div class="line">			&quot;price real,&quot; +</div><div class="line">			&quot;pages integer,&quot; +</div><div class="line">			&quot;name text)&quot; ;</div><div class="line"></div><div class="line">	private Context mContext ;</div><div class="line"></div><div class="line">	public MyDatabaseHelper(Context context, String name,</div><div class="line">			CursorFactory factory, int version) &#123;</div><div class="line">		super(context, name, factory, version);</div><div class="line">		mContext = context ;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onCreate(SQLiteDatabase db) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		db.execSQL(CREATE_BOOK) ;</div><div class="line">		Toast.makeText(mContext, &quot;Create succeeded&quot;, Toast.LENGTH_SHORT).show() ;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码意思是完成创建表的操作，我们决定点击一个按钮来完成数据库和表的创建工作，所以编写一个Button。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; &gt;</div><div class="line"></div><div class="line">	&lt;Button</div><div class="line">	    android:id=&quot;@+id/create_database&quot;</div><div class="line">	    android:layout_width=&quot;match_parent&quot;</div><div class="line">	    android:layout_height=&quot;wrap_content&quot;</div><div class="line">	    android:text=&quot;Create database&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>接下来修改MainActivity，添加创建数据库和按钮事件的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">package com.example.databasetest;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.content.ContentValues;</div><div class="line">import android.database.Cursor;</div><div class="line">import android.database.sqlite.SQLiteDatabase;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.util.Log;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line">import android.view.View.OnClickListener;</div><div class="line">import android.widget.Button;</div><div class="line"></div><div class="line">public class MainActivity extends Activity &#123;</div><div class="line"></div><div class="line">	private MyDatabaseHelper dbHelper ;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">		dbHelper = new MyDatabaseHelper(this, &quot;BookStore.db&quot;, null, 2) ;</div><div class="line"></div><div class="line">		Button createDatabase = (Button) findViewById(R.id.create_database) ;</div><div class="line">		createDatabase.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">			@Override</div><div class="line">			public void onClick(View v) &#123;</div><div class="line">				// TODO Auto-generated method stub</div><div class="line">				dbHelper.getWritableDatabase() ;</div><div class="line">			&#125;</div><div class="line">		&#125;) ;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>这时候，创建数据库和表的功能就完成了，运行应用，点击按钮，在命令行运行adb shell，查看../databases/下的文件，就会发现有一个BookStore.db文件，运行.shema命令，就可以查看建表语言了。</p>
<h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><p>增删改查是数据库的四种基本操作，添加数据使用insert()方法，我们先添一个添加数据的按钮：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:id=&quot;@+id/add_data&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:text=&quot;Add data&quot; /&gt;</div></pre></td></tr></table></figure>
<p>然后完成点击事件的功能，修改MainActivity的onCreate()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">//add data</div><div class="line">Button addData = (Button) findViewById(R.id.add_data) ;</div><div class="line">addData.setOnClickListener(new OnClickListener(</div><div class="line">		) &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		SQLiteDatabase db = dbHelper.getWritableDatabase() ;</div><div class="line">		ContentValues values = new ContentValues() ;</div><div class="line"></div><div class="line">		//添加第一条数据</div><div class="line">		values.put(&quot;name&quot;, &quot;The Da Vinci Code&quot;) ;</div><div class="line">		values.put(&quot;author&quot;, &quot;Dan Brown&quot;) ;</div><div class="line">		values.put(&quot;pages&quot;, 454) ;</div><div class="line">		values.put(&quot;price&quot;, 16.96) ;</div><div class="line">		db.insert(&quot;Book&quot;, null, values) ;</div><div class="line">		values.clear() ;</div><div class="line"></div><div class="line">		//添加第二条数据</div><div class="line">		values.put(&quot;name&quot;, &quot;The Lost Symbol&quot;) ;</div><div class="line">		values.put(&quot;author&quot;, &quot;Dan Brown&quot;) ;</div><div class="line">		values.put(&quot;pages&quot;, 510) ;</div><div class="line">		values.put(&quot;price&quot;, 16.95) ;</div><div class="line">		db.insert(&quot;Book&quot;, null, values) ;</div><div class="line">	&#125;</div><div class="line">&#125;) ;</div></pre></td></tr></table></figure>
<p>然后运行程序，点击添加按钮，输入select * from Book查询语句，可以看到我们刚才输入的数据了。</p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>更新数据与添加数据类似，我们先实现一个更新按钮：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:id=&quot;@+id/update_data&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:text=&quot;Update data&quot; /&gt;</div></pre></td></tr></table></figure>
<p>然后修改MainActivity中的onCreate()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//update data</div><div class="line">Button updateData = (Button) findViewById(R.id.update_data) ;</div><div class="line">updateData.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		SQLiteDatabase db = dbHelper.getWritableDatabase() ;</div><div class="line">		ContentValues values = new ContentValues() ;</div><div class="line">		values.put(&quot;price&quot;, 10.99) ;</div><div class="line">		db.update(&quot;Book&quot;, values, &quot;name=?&quot;, new String[]&#123;&quot;The Da Vinci Code&quot;&#125;) ;</div><div class="line">	&#125;</div><div class="line">&#125;) ;</div></pre></td></tr></table></figure>
<p>上面语句的意思是将name是The Da Vinci Code的那条数据的价格字段更新成10.99，运行程序，点击更新按钮，然后查询Book表数据，就可以看到更新了。</p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>删除数据也是一样的，我们先实现一个点击按钮：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:id=&quot;@+id/delete_data&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:text=&quot;Delete data&quot; /&gt;</div></pre></td></tr></table></figure>
<p>然后修改onCreate()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//delete data</div><div class="line">Button deleteData = (Button) findViewById(R.id.delete_data) ;</div><div class="line">deleteData.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		SQLiteDatabase db = dbHelper.getWritableDatabase() ;</div><div class="line">		db.delete(&quot;Book&quot;, &quot;pages &gt; ?&quot;, new String[]&#123;&quot;500&quot;&#125;) ;</div><div class="line">	&#125;</div><div class="line">&#125;) ;</div></pre></td></tr></table></figure>
<p>运行程序后，查询Book表，可以发现pages大于500的那条数据被删除了。</p>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>查询数据稍微复杂点，先实现查询按钮：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:id=&quot;@+id/query_data&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:text=&quot;Query data&quot; /&gt;</div></pre></td></tr></table></figure>
<p>然后修改MainActivity的onCreate()方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">//query data</div><div class="line">Button queryData = (Button) findViewById(R.id.query_data) ;</div><div class="line">queryData.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		SQLiteDatabase db = dbHelper.getWritableDatabase() ;</div><div class="line">		//查询Book表所有数据</div><div class="line">		Cursor cursor = db.query(&quot;Book&quot;, null, null, null, null, null, null) ;</div><div class="line">		if(cursor.moveToFirst())&#123;</div><div class="line">			do&#123;</div><div class="line">				//遍历Cursor对象，得到数据</div><div class="line">				String name = cursor.getString(cursor.getColumnIndex(&quot;name&quot;)) ;</div><div class="line">				String author = cursor.getString(cursor.getColumnIndex(&quot;author&quot;)) ;</div><div class="line">				int pages = cursor.getInt(cursor.getColumnIndex(&quot;pages&quot;)) ;</div><div class="line">				double price = cursor.getDouble(cursor.getColumnIndex(&quot;pages&quot;)) ;</div><div class="line"></div><div class="line">				//打印数据</div><div class="line">				Log.d(&quot;MainActivity&quot;, &quot;book name is &quot; + name) ;</div><div class="line">				Log.d(&quot;MainActivity&quot;, &quot;book author is &quot; + author) ;</div><div class="line">				Log.d(&quot;MainActivity&quot;, &quot;book pages is &quot; + pages) ;</div><div class="line">				Log.d(&quot;MainActivity&quot;, &quot;book price is &quot; + price) ;</div><div class="line">			&#125;while(cursor.moveToNext()) ;</div><div class="line">		&#125;</div><div class="line">		cursor.close() ;</div><div class="line">	&#125;</div><div class="line">&#125;) ;</div></pre></td></tr></table></figure>
<p>使用一个do..while()来实现打印数据，运行程序后，点击查询按钮，查看LogCat就可以发现打印信息了。</p>
<h3 id="利用事务实现替换数据"><a href="#利用事务实现替换数据" class="headerlink" title="利用事务实现替换数据"></a>利用事务实现替换数据</h3><p>事务的特点是保证一系列的操作要么全部完成，要么一个都不会完成，比如银行转账操作，要么转账成功，要么转账失败，不会出现你的钱被扣了，对方没接收到钱的现象。  </p>
<p>我们准备实现一个替换数据的功能，要么删除数据并添加新数据，要么什么都不操作。首先实现一个替换按钮：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Button</div><div class="line">    android:id=&quot;@+id/replace_data&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:text=&quot;Replace data&quot; /&gt;</div></pre></td></tr></table></figure>
<p>然后修改MainActivity的onCreate()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">//replace data</div><div class="line">Button replaceData = (Button) findViewById(R.id.replace_data) ;</div><div class="line">replaceData.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		SQLiteDatabase db = dbHelper.getWritableDatabase() ;</div><div class="line">		db.beginTransaction() ;</div><div class="line">		try&#123;</div><div class="line">			db.delete(&quot;Book&quot;, null, null) ;</div><div class="line"></div><div class="line">			if(true)&#123;</div><div class="line">				throw new NullPointerException() ;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			ContentValues values = new ContentValues() ;</div><div class="line">			values.put(&quot;name&quot;, &quot;Game of Thrones&quot;) ;</div><div class="line">			values.put(&quot;author&quot;, &quot;George Martin&quot;) ;</div><div class="line">			values.put(&quot;pages&quot;, 720) ;</div><div class="line">			values.put(&quot;price&quot;, 20.85) ;</div><div class="line">			db.insert(&quot;Book&quot;, null, values) ;</div><div class="line">			db.setTransactionSuccessful() ;	//事务执行成功</div><div class="line">		&#125;catch(Exception e)&#123;</div><div class="line">			e.printStackTrace() ;</div><div class="line">		&#125;finally&#123;</div><div class="line">			db.endTransaction() ;		//结束事务</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;) ;</div></pre></td></tr></table></figure>
<p>在该程序中，我们抛出了一个空指针异常，模拟操作失败，运行程序后，点击替换，你会发现数据并没有删除，但如果删除下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if(true)&#123;</div><div class="line">	throw new NullPointerException() ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就会发现数据被替换了。</p>
<h3 id="正确的升级数据库"><a href="#正确的升级数据库" class="headerlink" title="正确的升级数据库"></a>正确的升级数据库</h3><p>升级数据库在开发中非常常见。比如我们想新增一个Category表，修改MyDatabaseHelper类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">package com.example.databasetest;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line">import android.database.sqlite.SQLiteDatabase;</div><div class="line">import android.database.sqlite.SQLiteDatabase.CursorFactory;</div><div class="line">import android.database.sqlite.SQLiteOpenHelper;</div><div class="line">import android.widget.Toast;</div><div class="line"></div><div class="line">public class MyDatabaseHelper extends SQLiteOpenHelper &#123;</div><div class="line"></div><div class="line">	public static final String CREATE_BOOK = &quot;create table Book(&quot; +</div><div class="line">			&quot;id integer primary key autoincrement,&quot; +</div><div class="line">			&quot;author text,&quot; +</div><div class="line">			&quot;price real,&quot; +</div><div class="line">			&quot;pages integer,&quot; +</div><div class="line">			&quot;name text)&quot; ;</div><div class="line"></div><div class="line">	public static final String CREATE_CATEGORY = &quot;create table Category(&quot; +</div><div class="line">			&quot;id integer primary key autoincrement,&quot; +</div><div class="line">			&quot;category_name text,&quot; +</div><div class="line">			&quot;category_code integer)&quot; ;</div><div class="line"></div><div class="line">	private Context mContext ;</div><div class="line"></div><div class="line">	public MyDatabaseHelper(Context context, String name,</div><div class="line">			CursorFactory factory, int version) &#123;</div><div class="line">		super(context, name, factory, version);</div><div class="line">		mContext = context ;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onCreate(SQLiteDatabase db) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		db.execSQL(CREATE_BOOK) ;</div><div class="line">		db.execSQL(CREATE_CATEGORY) ;</div><div class="line">		Toast.makeText(mContext, &quot;Create succeeded&quot;, Toast.LENGTH_SHORT).show() ;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		switch (oldVersion) &#123;</div><div class="line">		case 1:</div><div class="line">			db.execSQL(CREATE_CATEGORY) ;</div><div class="line">		default:</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过使用switch来判断数据库是否需要升级。如果以后数据库发生变动，只需要在switch加case就行，只将需要修改的数据库进行升级，不需要的不变。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2014/07/24/玩转ProGuard/" class="prev">PREV</a><a href="/2014/06/25/SQL语句的总结/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'hyyyblog';
var disqus_identifier = '2014/07/02/sqlite3在Android上的简单应用/';
var disqus_title = 'sqlite3在Android上的简单应用';
var disqus_url = 'http://yoursite.com/2014/07/02/sqlite3在Android上的简单应用/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//hyyyblog.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">Hyyy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>